@model YeniSalon.Models.Randevu

@{
    ViewData["Title"] = "Yeni Randevu Oluştur";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="text-center">Yeni Randevu Oluştur</h3>
                </div>
                <div class="card-body">
                    <form asp-action="Create" id="randevuForm">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        
                        <input type="hidden" asp-for="KullaniciId" value="@ViewBag.userId" class="form-control" />

                        <!-- Antrenör Seçimi -->
                        <div class="mb-3">
                            <label asp-for="AntrenorId" class="form-label"></label>
                            <select asp-for="AntrenorId" class="form-select" id="antrenorSelect" required>
                                <option value="">Antrenör Seçiniz</option>
                                @foreach (var item in (List<SelectListItem>)ViewBag.Antrenorler)
                                {
                                    <option value="@item.Value" data-name="@item.Text">@item.Text</option>
                                }
                            </select>
                            <span asp-validation-for="AntrenorId" class="text-danger"></span>
                        </div>

                        <!-- Hizmet Seçimi -->
                        <div class="mb-3">
                            <label asp-for="HizmetId" class="form-label"></label>
                            <select asp-for="HizmetId" class="form-select" id="hizmetSelect" required>
                                <option value="">Hizmet Seçiniz</option>
                                @foreach (var item in (List<SelectListItem>)ViewBag.Hizmetler)
                                {
                                    <option value="@item.Value" data-sure="@item.Text.Split('-').Last().Trim().Split(' ')[0]"
                                            data-name="@item.Text">@item.Text</option>
                                }
                            </select>
                            <span asp-validation-for="HizmetId" class="text-danger"></span>
                        </div>

                        <!-- Tarih Seçimi (SADECE MÜSAİT TARİHLER GELECEK) -->
                        <div class="mb-3">
                            <label class="form-label">Tarih Seçiniz</label>
                            <select id="dateSelect" class="form-select" disabled required>
                                <option value="">Önce antrenör ve hizmet seçin</option>
                            </select>
                            <small class="text-muted">Sadece antrenörün müsait olduğu tarihler gösterilmektedir</small>
                            <div id="dateLoading" class="text-primary mt-1" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Tarihler yükleniyor...
                            </div>
                        </div>

                        <!-- Saat Seçimi (SADECE MÜSAİT SAATLER GELECEK) -->
                        <div class="mb-3">
                            <label class="form-label">Saat Seçiniz</label>
                            <select id="timeSelect" class="form-select" disabled required>
                                <option value="">Önce tarih seçin</option>
                            </select>
                            <small class="text-muted">Sadece müsait saat aralıkları gösterilmektedir</small>
                            <div id="timeLoading" class="text-primary mt-1" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Saatler yükleniyor...
                            </div>
                        </div>

                        <!-- Hidden input for RandevuTarihi -->
                        <input type="hidden" asp-for="RandevuTarihi" id="randevuTarihiHidden" />

                        <!-- Seçilen Randevu Bilgisi -->
                        <div id="selectedAppointment" class="alert alert-info" style="display: none;">
                            <h6>Seçilen Randevu:</h6>
                            <p id="selectedDateTimeText">-</p>
                            <p><strong>Antrenör:</strong> <span id="selectedAntrenorText">-</span></p>
                            <p><strong>Hizmet:</strong> <span id="selectedHizmetText">-</span></p>
                            <p><strong>Süre:</strong> <span id="selectedSureText">-</span> dakika</p>
                        </div>

                        <!-- Müsaitlik Durumu -->
                        <div id="availabilityStatus" class="alert" style="display: none;">
                            <i class="fas fa-info-circle"></i> <span id="availabilityText"></span>
                        </div>

                        <!-- Not -->
                        <div class="mb-3">
                            <label asp-for="Not" class="form-label"></label>
                            <textarea asp-for="Not" class="form-control" rows="3" placeholder="Randevu için özel notunuz..."></textarea>
                            <span asp-validation-for="Not" class="text-danger"></span>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                                <i class="fas fa-save"></i> Randevu Talebi Oluştur
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="fas fa-times"></i> İptal
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Bilgilendirme -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5><i class="fas fa-info-circle text-primary"></i> Bilgilendirme:</h5>
                    <ul class="mb-0">
                        <li>Sadece antrenörün <strong>müsait olduğu tarih ve saatler</strong> gösterilmektedir</li>
                        <li>Randevular antrenör onayından sonra kesinleşir</li>
                        <li>İptaller için en az 2 saat önce bildirim yapınız</li>
                        <li>Randevu saatinizden 1 saat önce hatırlatma mesajı alacaksınız</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        #selectedAppointment {
            border-left: 4px solid #0d6efd;
        }

        #availabilityStatus.success {
            background-color: #d1e7dd;
            border-color: #badbcc;
            color: #0f5132;
        }

        #availabilityStatus.warning {
            background-color: #fff3cd;
            border-color: #ffecb5;
            color: #664d03;
        }

        #submitBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
}

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    
    <script src="~/js/uyeRandevuCreate.js"></script>
}